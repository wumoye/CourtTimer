# CourtTimer 项目备忘

## 目标与确认需求
- Flutter 多平台计时器，提供预设 6 分钟、1 分钟、30 秒以及自定义时长。
- 服务篮球自训练或对抗赛使用，开局需有 3-2-1 语音预热，运行期间保持屏幕常亮。
- 运行时按启用的节点（120/60/30 秒）播报剩余时间，可选 10~0 逐秒倒计时。
- 支持开始 / 暂停 / 重置操作，按钮与长按手势两种入口。
- 支持中文 / 英文 / 日文界面与语音配置，语音文案贴合篮球节奏。

## 已实现功能
- `SettingsController` + 底部设置面板，支持语言 / 语音模式切换（多语言 UI 即时生效）。
- `TimerController` 管理状态、语音播报、里程碑以及屏幕唤醒。
- UI 组件 `DurationSelector`、`AnnouncementPanel`、`TimerDisplay` 与自定义时长弹窗协同工作。
- `DurationFormatter` 提供 mm:ss 数字格式以及多语言文本 / 语音描述。
- `SpeechService` 封装 `flutter_tts` + 可配置结束音效（支持从 `assets/audio/` 选择哨声），根据当前语言播报开始、时间到、剩余时长与逐秒倒计时。
- 通过 `SharedPreferences` 持久化语言、语音模式、结束音效、计时器时长与里程碑设置，应用重启后自动恢复。
- 基础 Widget 测试覆盖 `TimerPage` 主要组件渲染（调整测试尺寸避免溢出）。
- 已完成 `flutter analyze` 与 `flutter test`。

## 待办与建议
- 完成离线语音包与在线 TTS 接入（当前 UI 已预留入口）。
- 增加不同语音风格或音色选择，可结合 VoiceVox / Google Cloud TTS。
- 支持更多播报策略（震动、提示音等）。
- 扩展多语言 / 主题、自适应平板布局。
- 视需求补充更细粒度的单元或集成测试。

## 最新更新
- 引入 Flutter 本地化，新增中 / 英 / 日界面文案与设置面板。
- 语音服务绑定设置控制器，自动根据语言切换 TTS 配置。
- 调整时长标签、里程碑、语音文本为多语言输出。
- 设置面板新增“结束音效”下拉框，可加载 `assets/audio/` 中的 mp3/wav/m4a 文件，支持自定义哨声并提供即时预览，整体布局居中且防止溢出。
- 全局设定（语言、语音模式、结束音、时长与提醒）统一写入本地存储并在启动时恢复；试听自动在约 1.2 秒后复位。
- `SpeechService` 在播报“时间到”前先播放所选音效；无配置时退回系统提示音。
- 新增 `assets/` 目录与 `.gitignore` 保护密钥文件（如 `assets/tts_service_key.json`）。
- 更新 Widget 测试以适应新布局。
- 自定义时长弹窗重构为带状态组件，修复 `TextEditingController` 提前释放导致的崩溃，并保持滑条与输入框同步。
- 设置面板改为可滚动布局，解决英文字段在小屏设备上的像素溢出。
- 2025-10-07：`flutter analyze` 与 `flutter test` 均通过。

## 协作规则
- 优先在原有 `memo.md` 基础上增量编辑，除非编码等问题无法修复再考虑重建。
- 关键文档建议及时提交到 Git，确保随时可回滚历史变更。
- 每次完成功能或调整配置后，及时更新备忘录，保持记录与实际实现一致。
